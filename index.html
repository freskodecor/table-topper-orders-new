<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Topper Orders</title>
    
    <link href="styles.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
        
        // Process PDF and extract data
        async function processPDF(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                let fullText = '';
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items
                        .map(item => item.str)
                        .join(' ')
                        .replace(/\s+/g, ' ');
                    fullText += pageText + '\n';
                }

                // Extract data using your existing patterns
                const orderData = {
                    customerName: extractCustomerName(fullText),
                    orderDate: extractOrderDate(fullText),
                    shipByDate: extractShipByDate(fullText),
                    tableSize: extractTableSize(fullText),
                    fabric: extractFabric(fullText),
                    umbrellaHole: !fullText.toLowerCase().includes('no umbrella')
                };

                // Display the extracted data
                displayData(orderData);
                return orderData;

            } catch (error) {
                console.error('Error processing PDF:', error);
                alert('Error processing PDF. Please try again.');
            }
        }

        // Extract customer name
        function extractCustomerName(text) {
            const nameMatch = text.match(/Ship to\s+(.*?)[\d{5}|\n]/);
            return nameMatch ? nameMatch[1].trim() : '';
        }

        // Add other extraction functions here...

        // Display extracted data
        function displayData(data) {
            const display = document.getElementById('dataDisplay');
            display.innerHTML = `
                <h2>Extracted Data:</h2>
                <p>Customer: ${data.customerName}</p>
                <p>Order Date: ${data.orderDate}</p>
                <p>Ship By: ${data.shipByDate}</p>
                <p>Table Size: ${data.tableSize}</p>
                <p>Fabric: ${data.fabric}</p>
                <p>Umbrella Hole: ${data.umbrellaHole ? 'Yes' : 'No'}</p>
            `;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('pdfUpload');
            fileInput.addEventListener('change', async (event) => {
                const file = event.target.files[0];
                if (file && file.type === 'application/pdf') {
                    await processPDF(file);
                }
            });
        });
    </script>
</head>
<body class="bg-gray-100">
    <div class="max-w-4xl mx-auto p-4">
        <div class="bg-white shadow-lg rounded-lg p-6">
            <h1 class="text-2xl font-bold mb-4">Table Topper Order Processor</h1>
            <input type="file" id="pdfUpload" accept=".pdf" class="mb-4">
            <div id="dataDisplay" class="mt-4"></div>
        </div>
    </div>
</body>
</html>
